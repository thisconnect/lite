/* Company v1.0. Copyrighted 2011 Mark Joseph Obcena. MIT-Style License. */
(function(){var c=Events.removeOn||function(i){return i.replace(/^on([A-Z])/,function(j,k){return k.toLowerCase();});};var g=function(){var j=arguments.length;while(j--){var l=arguments[j];switch(typeOf(l)){case"type":case"class":l.$prototyping=true;Object.append(this,new l);delete l.$prototyping;break;case"unit":for(var k in l){if(l.hasOwnProperty(k)){this[k]=l[k];}}break;default:Object.append(this,l);}}return this;};var f=function(l){for(var j in l){var k=l[j];if(k instanceof Function&&k.$origin){l[j]=k.$origin;}}return l;};var h=function(){var i=h.current;i.apply(i.$ownerObj,h.args);};var b=Object.append(f(new Events),{$dispatched:{},$finished:{},$mediator:(this.document)?this.document.createElement("script"):null,setup:function(){var j=this.$mediator;if(!j||(!j.attachEvent&&!j.addEventListener)){return this;}if(j.addEventListener){j.addEventListener("publishDispatch",h,false);this.dispatch=function(k){var l=document.createEvent("UIEvents");l.initEvent("publishDispatch",false,false);h.current=k;j.dispatchEvent(l);};}else{if(j.attachEvent&&!j.addEventListener){$(document.head).appendChild(j);j.publishDispatch=0;j.attachEvent("onpropertychange",h);this.dispatch=function(k){h.current=k;j.publishDispatch++;};var i=function(){j.detachEvent("onpropertychange",h);j.parentNode.removeChild(j);this.detachEvent("onunload",cleanup);};window.attachEvent("onunload",i);}}return this;},getFinished:function(i){return this.$finished[i]||null;},getDispatched:function(i){return this.$dispatched[i]||[];},dispatch:function(i){h.current=i;h.call(null);},replay:function(j,i){if(!this.$dispatched||!this.$dispatched[j]){return false;}h.args=this.$dispatched[j];this.dispatch(i);return true;},redispatch:function(j,i){if(!this.$finished||!this.$finished[j]){return false;}h.args=this.$finished[j];this.dispatch(i);return true;},fireEvent:function(l,j,k){var i=this;l=c(l);j=Array.from(j);if(k){this.$finished[l]=j;}this.$dispatched[l]=h.args=j;if(!this.$events||!this.$events[l]){return this;}this.$events[l].each(this.dispatch);return this;},removeEvents:function(l){var m;if(typeOf(l)=="object"){for(m in l){this.removeEvent(m,l[m]);}return this;}if(l){l=c(l);}for(m in this.$events){if(l&&l!=m){continue;}var k=this.$events[m];for(var j=k.length;j--;){if(j in k){this.removeEvent(m,k[j]);}}}return this;},flush:function(){var j;this.removeEvents();delete b.$events;b.$events={};var l=this.$finished;for(j in l){if(l.hasOwnProperty(j)&&!({"window.domready":1,"window.load":1})[j]){delete l[j];}}var k=this.$dispatched;for(j in k){if(k.hasOwnProperty(j)&&!({"window.domready":1,"window.load":1})[j]){delete k[j];}}return this;}}).setup();window.addEvents({domready:function(){b.fireEvent("window.domready",[],true);},load:function(){b.fireEvent("window.load",[],true);}});function d(i){if(!(this instanceof d)){return new d(i);}this.$unitAttached=true;this.$unitHandlers={};this.$unitPrefix="";if(d.$prototyping){return this;}if(i){this.extendUnit(i);this.setupUnit();}return this;}var e=function(i,k){var j=function(){k.apply(this,arguments);return i.apply(this,arguments);};j.$unwrapped=i;return j;};this.Unit=new Type("Unit",d).extend({isUnit:function(i){if(typeOf(i)==="unit"){return true;}else{return i.$unitInstance?i.$unitInstance instanceof d:false;}},decorate:function(m,j){if(!m.$unitInstance){var l=m.$unitInstance=new d;l.extendUnit=function(i){g.call(m,i);return this;};for(var k in l){(function(i,n){if(!m[k]&&k!=="$family"&&n instanceof Function){m[k]=function(){return n.apply(l,arguments);};m[k].$origin=n;}})(k,l[k]);}m.setupUnit();if(!j){this.wrapEvents(m);}}return m;},undecorate:function(l){var k=l.$unitInstance;if(k){for(var j in k){(function(i,m){if(l[i]&&l[i].$origin==m){delete l[i];}})(j,k[j]);}this.unwrapEvents(l);delete l.$unitInstance;}return l;},wrapEvents:function(i){if(i.fireEvent&&!i.fireEvent.$unwrapped){i.fireEvent=e(i.fireEvent,function(k,j){i.publish(k,j);});}return i;},unwrapEvents:function(i){if(i.fireEvent&&i.fireEvent.$unwrapped){i.fireEvent=i.fireEvent.$unwrapped;}return i;}}).implement({setupUnit:function(){var i=this;if(this.Uses){Array.from(this.Uses).each(this.extendUnit.bind(this));delete this.Uses;}if(this.Prefix){this.setPrefix(this.Prefix);delete this.Prefix;}if(this.initSetup){b.dispatch(function(){i.initSetup.apply(i);});}if(this.readySetup){this.subscribe("window.domready",function(){i.readySetup();});}if(this.loadSetup){this.subscribe("window.load",function(){i.loadSetup();});}return this;},extendUnit:function(i){g.call(this,i);return this;},getPrefix:function(){return this.$unitPrefix;},setPrefix:function(i){this.$unitPrefix=(i||"").toString();return this;},isAttached:function(){return !!this.$unitAttached;},detachUnit:function(){var k=this.$unitHandlers;if(!this.$unitAttached){return this;}for(var j in k){var i=k[j].length;while(i--){b.removeEvent(j,k[j][i]);}}this.$unitAttached=false;return this;},attachUnit:function(){var k=this.$unitHandlers;if(this.$unitAttached){return this;}for(var j in k){var i=k[j].length;while(i--){b.addEvent(j,k[j][i]);}}this.$unitAttached=true;return this;},destroyUnit:function(){this.detachUnit();this.$unitHandlers={};return this;},subscribe:function(k,l,m){if(typeof k=="object"){for(var j in k){this.subscribe(j,k[j],l);}}else{if(k.charAt(0)=="!"){m=true;k=k.substring(1);}l.$ownerObj=this;if(!b.redispatch(k,l)){Events.prototype.addEvent.call({$events:this.$unitHandlers},k,l);if(this.$unitAttached){b.addEvent(k,l);if(m){b.replay(k,l);}}}}return this;},unsubscribe:function(k,l){if(typeof k!=="string"){for(var j in k){this.unsubscribe(j,k[j]);}}else{b.removeEvent(k,l);Events.prototype.removeEvent.call({$events:this.$unitHandlers},k,l);}return this;},publish:function(k,i,j){if(k.charAt(0)=="!"){k=k.substring(1);}else{if(this.$unitPrefix){k=this.$unitPrefix+"."+k;}}if(this.$unitAttached){b.fireEvent.call(b,k,i,j);}return this;}});var a=function(i){var j=function(){j.$spy.apply(null,arguments);j.$unwrapped.apply(b,arguments);};return Object.append(j,{$unwrapped:i});};d.Dispatcher={flush:function(){b.flush();return this;},getFinished:function(){return Object.clone(b.$finished);},getDispatched:function(i){return i?(b.$dispatched[i]||[]).clone():Object.clone(b.$dispatched);},getSubscribers:function(i){return i?(b.$events[i]||[]).clone():Object.clone(b.$events);},spySubscribe:function(j){var i=b.addEvent;if(!i.$unwrapped){b.addEvent=a(i);}b.addEvent.$spy=j;return this;},unspySubscribe:function(){var i=b.addEvent;if(i.$unwrapped){b.addEvent=i.$unwrapped;}return this;},spyUnsubscribe:function(i){var j=b.removeEvent;if(!j.$unwrapped){b.removeEvent=a(j);}b.removeEvent.$spy=i;return this;},unspyUnsubscribe:function(){var i=b.removeEvent;if(i.$unwrapped){b.removeEvent=i.$unwrapped;}return this;},spyPublish:function(j){var i=b.fireEvent;if(!i.$unwrapped){b.fireEvent=a(i);}b.fireEvent.$spy=j;return this;},unspyPublish:function(){var i=b.fireEvent;if(i.$unwrapped){b.fireEvent=i.$unwrapped;}return this;}};}).call(this);